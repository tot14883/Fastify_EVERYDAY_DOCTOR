"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var console_1=require("console"),fastify=__importStar(require("fastify")),multer=require("fastify-multer"),ws_1=__importDefault(require("ws")),router_1=__importDefault(require("./router")),app=fastify.fastify({logger:{level:"info"}});app.register(multer.contentParser),app.register(require("fastify-cors")),app.register(require("fastify-formbody")),app.register(require("./plugins/db"),{options:{client:"mysql2",connection:{host:"localhost",port:3308,user:"root",password:"",database:"test"},debug:!0},connectionName:"db"}),app.register(require("./plugins/db"),{options:{client:"mysql2",connection:{host:"localhost",port:3308,user:"root",password:"",database:"test2"},debug:!0},connectionName:"db2"}),app.register(require("./plugins/jwt"),{secret:"$#200011111#@"}),app.register(require("./plugins/ws")),app.register(require("./plugins/io"),{}),app.ready(function(e){if(e)throw console_1.error;console.log("WebSocket server running..."),app.io.on("connection",function(t){console.log("user connected!"),t.on("welcome",function(e){t.emit("welcome","Hello")}),t.on("chat message",function(e){t.broadcast.emit("chat message",e)})}),app.ws.on("connection",function(e){console.log("Client connected!"),e.on("message",function(t){app.ws.clients.forEach(function(e){e.readyState===ws_1.default.OPEN&&e.send(t)})})})}),app.register(router_1.default),exports.default=app;